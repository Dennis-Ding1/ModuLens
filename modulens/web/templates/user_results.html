{% extends "base.html" %}

{% block title %}Results - ModuLens{% endblock %}

{% block extra_css %}
<style>
    .results-container {
        margin-top: 20px;
    }
    .prompt-box {
        background-color: #f8f9fa;
        border-left: 3px solid #0d6efd;
        padding: 15px;
        margin-bottom: 15px;
        border-radius: 4px;
    }
    .response-box {
        background-color: #f0f7ff;
        border-left: 3px solid #198754;
        padding: 15px;
        margin-bottom: 15px;
        border-radius: 4px;
        white-space: pre-wrap;
    }
    .strategy-info {
        margin: 15px 0;
        padding: 10px;
        background-color: #e9ecef;
        border-radius: 4px;
    }
    .model-badge {
        margin-right: 5px;
    }
    .backToForm {
        margin-bottom: 30px;
    }
    .view-actions {
        display: flex;
        gap: 10px;
        margin-bottom: 20px;
    }
</style>
{% endblock %}

{% block content %}
<div class="row mb-4">
    <div class="col-md-12">
        <h1>Results</h1>
        <div class="view-actions">
            <a href="{{ url_for('index') }}" class="btn btn-outline-primary">
                <i class="bi bi-arrow-left"></i> Back to Prompt Form
            </a>
            <a href="{{ url_for('switch_view', view_type='debug') }}" class="btn btn-outline-secondary">
                <i class="bi bi-file-earmark-code"></i> Switch to Debug View
            </a>
        </div>
    </div>
</div>

<div class="row">
    <div class="col-md-12">
        <div class="card">
            <div class="card-header bg-primary text-white">
                <h5 class="mb-0">Consolidated Response</h5>
            </div>
            <div class="card-body">
                <h6>Your Prompt:</h6>
                <div class="prompt-box">{{ prompt }}</div>
                
                {% if results.consolidated_response %}
                <h6>Response:</h6>
                <div class="response-box">{{ results.consolidated_response }}</div>
                
                <div class="alert alert-info mt-4">
                    <h6 class="alert-heading">About This Response</h6>
                    <p>This response was generated by consolidating all the useful answers from different strategies. 
                       Switch to Debug View to see individual strategy results.</p>
                </div>
                {% else %}
                <div class="alert alert-warning">
                    <h6 class="alert-heading">No Useful Responses Found</h6>
                    <p>None of the strategies produced a response rated as "Useful" for your prompt. 
                    You might want to try rephrasing your prompt or check the Debug View to see detailed results.</p>
                </div>
                {% endif %}
            </div>
        </div>
    </div>
</div>

<!-- Show information about strategies that succeeded -->
{% if results.debug_results and results.debug_results.successful_strategies %}
<div class="row mt-4">
    <div class="col-md-12">
        <div class="card">
            <div class="card-header bg-success text-white">
                <h5 class="mb-0">Successful Strategies</h5>
            </div>
            <div class="card-body">
                <p>The following strategies were successful in bypassing content moderation:</p>
                <ul class="list-group">
                    {% for strategy in results.debug_results.successful_strategies %}
                    <li class="list-group-item d-flex justify-content-between align-items-center">
                        {{ strategy }}
                        <span class="badge bg-success rounded-pill">âœ“</span>
                    </li>
                    {% endfor %}
                </ul>
                <div class="mt-3">
                    <a href="{{ url_for('switch_view', view_type='debug') }}" class="btn btn-sm btn-outline-primary">
                        View Detailed Results
                    </a>
                </div>
            </div>
        </div>
    </div>
</div>
{% endif %}
{% endblock %} 